<!DOCTYPE html>
{% load static %}
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path-In</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <style>
       body {
    background-image: url("{% static 'img/background.png' %}");
    background-repeat: repeat;
    font-family: Arial, sans-serif; /* Improved readability on small devices */
}

nav {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem;
    background-color: #1b6a8f;
}

.image1 {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover; /* Ensures full image coverage */
}
span {
    font-weight: bold;
    font-family: 'Lobster', cursive;
    font-size: 1.5rem;
    color: white;
}

.centered-container {
    display: flex;
    justify-content: center;
    align-items: center;
}

input[type="text"] {
    width: 90%; /* Adjusted for mobile */
    margin: 10px 0; /* More space between inputs */
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
    outline: none;
}

input[type="text"]:focus {
    border-color: #4CAF50;
    border-bottom: 2px solid #4CAF50;
}

button {
    background-color: #3493C5;
    border: none;
    color: white;
    padding: 12px 20px;
    text-align: center;
    text-decoration: none;
    display: block; /* Full width for mobile */
    width: 100%;
    margin: 10px 0;
    cursor: pointer;
    font-size: 16px;
}

button:hover {
    background-color: #2B6D8F;
    box-shadow: 0 8px 12px rgba(0,0,0,0.2);
}

.floor-map {
    width: 100vw; /* 100% viewport width */
    height: 100vh; /* 100% viewport height */
    position: relative; /* Required for dragging */
    display: flex; /* Center the image horizontally */
    justify-content: center;
    align-items: center;
}

#form-section {
    background-color: #f2f2f2;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.floor-selection img {
    width: 40px; /* Smaller icons for mobile */
    height: 40px;
    transition: transform 0.3s;
}

.floor-selection button {
    background: none;
    border: none;
    padding: 5px;
}

.floor-selection button:hover img {
    transform: scale(1.1);
}
    </style>
</head>
<body>
<nav>
    <span>PathIn</span>
</nav>

<div id="section1">
    <div class="centered-container">
        <form method="post" action="{% url 'index' %}">
            {% csrf_token %}
            <input id="loc" name="location" type="text" placeholder="Enter location" value="{{source}}">
            <input name="destination" type="text" placeholder="Enter destination">
            <button type="submit">Search</button>
        </form>
    </div>
    <div class="floor-selection centered-container">
        <h3>Select Floor:</h3>
        <button id="{{select0}}" onclick="showFloorMap(0)">
            <img src="{% static 'img/letter-g.png' %}" alt="Ground Floor">
        </button>
        <button id="{{select1}}" onclick="showFloorMap(1)">
            <img src="{% static 'img/number-one.png' %}" alt="1st Floor">
        </button>
        <button id="{{select2}}" onclick="showFloorMap(2)">
            <img src="{% static 'img/number-2.png' %}" alt="2nd Floor">
        </button>
    </div>
</div>
    <div id="floor0" class="floor-map">
    <img class="image1" src="{% static GFloor_url %}" alt="Ground Floor Map">
</div>
<div id="floor1" class="floor-map">
    <img class="image1" src="{% static 1stFloor_url %}" alt="1st Floor Map">
</div>
<div id="floor2" class="floor-map">
    <img class="image1" src="{% static 2ndFloor_url %}" alt="2nd Floor Map">
</div>
{% if messages %}
    <script type="text/javascript">
    window.addEventListener('load', function() {
        {% for message in messages %}
            alert("{{ message }}");
        {% endfor %}
    });
    </script>
{% endif %}
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script>
  $( function() {
    $( ".point" ).autocomplete({
      source: '{% url 'autocomplete' %}'

    });
  } );
  </script>
<script>
 document.addEventListener('DOMContentLoaded', function() {
    var currentFloorMap = document.querySelector('.floor-map.active'); // Select the active map
    var mapImage = currentFloorMap ? currentFloorMap.querySelector('.image1') : null;

    if (mapImage) { // Only proceed if an image is found
        var isDragging = false;
        var originalX = 0;
        var originalY = 0;
        var translateX = 0;
        var translateY = 0;

        mapImage.addEventListener('mousedown', function(event) {
            isDragging = true;
            originalX = event.clientX - translateX;
            originalY = event.clientY - translateY;
            // Prevent default dragging behavior
            event.preventDefault();
        });

        document.addEventListener('mousemove', function(event) {
            if (isDragging) {
                translateX = event.clientX - originalX;
                translateY = event.clientY - originalY;

                // Constrain movement within viewport boundaries
                var maxOffsetX = currentFloorMap.offsetWidth - mapImage.offsetWidth;
                var maxOffsetY = currentFloorMap.offsetHeight - mapImage.offsetHeight;

                // Limit horizontal and vertical drag
                translateX = Math.min(Math.max(translateX, -mapImage.offsetWidth + currentFloorMap.offsetWidth), 0);
                translateY = Math.min(Math.max(translateY, -mapImage.offsetHeight + currentFloorMap.offsetHeight), 0);

                mapImage.style.transform = 'translate(' + translateX + 'px, ' + translateY + 'px)';
            }
        });

        document.addEventListener('mouseup', function() {
            isDragging = false;
        });

        document.addEventListener('mouseleave', function() {
            if (isDragging) {
                isDragging = false; // Stop dragging if the mouse leaves the document
            }
        });
    }
});
        function showFloorMap(floorNumber) {
    // Hide all floor maps
    var maps = document.querySelectorAll('.floor-map');
    maps.forEach(function(map) {
        map.style.display = 'none';
    });

    // Show the selected floor map
    var selectedMap = document.getElementById('floor' + floorNumber);
    if (selectedMap) {
        console.log('Found floor map for floor:', floorNumber); // Log success
        selectedMap.style.display = 'flex';
    } else {
        console.log('No floor map found for floor:', floorNumber); // Log failure
    }
}
    $(document).ready(function() {
        $("#loc").keyup(function() {
            var text = $(this).text().slice(0, -1)
var defaultLink = "/path/"
var pathlink = "/path/path?loc="
var position = arr.indexOf(text)
position == -1 ? arr.push(text) : arr.splice(position, 1)
$('.ecmt-button').attr('href', arr.length == 0 ? defaultLink : pathlink + arr.join())
        });
    });
// Call showFloorMap for the 1st floor on page load
document.addEventListener('DOMContentLoaded', function() {
    showFloorMap(1); // Adjust the index if your floor numbering is different
});
</script>
</body>
</html>
